# 多词性翻译功能说明

## 功能概述

现在单词翻译卡片会显示单词的**所有词性和释义**，让用户全面了解单词的不同用法。

## 示例效果

### 单词：even

**之前显示：**
```
even
[ˈiːvən]
adj. 平坦的；偶数的
```

**现在显示：**
```
even
UK [ˈiːvn]  US [ˈiːvən]

adj. 平的；平滑的；相等的；均衡的；偶数的；平静的
adv. 甚至；更加；即使；恰好；完全
v. 使平坦；使相等
n. 傍晚；平地
```

### 单词：run

**现在显示：**
```
run
UK [rʌn]  US [rʌn]

v. 跑；运转；运营；管理；竞选；行驶；蔓延；流动
n. 跑步；赛跑；趋向；奔跑；运转；路程
adj. 熔化的；浇铸的
```

## 技术实现

### 后端改进

**数据提取：**
```javascript
// 提取所有翻译条目
const translations = [];
wordData.trs.forEach(tr => {
  item.l.i.forEach(meaning => {
    translations.push(meaning.trim());
  });
});

// 按词性分组
groupTranslationsByType(translations)
// 返回: [
//   { type: 'n.', meanings: ['名词释义1', '名词释义2'] },
//   { type: 'v.', meanings: ['动词释义1', '动词释义2'] },
//   { type: 'adj.', meanings: ['形容词释义'] }
// ]
```

**返回数据结构：**
```javascript
{
  word: 'even',
  phonetic: 'ˈiːvən',     // 通用音标（兼容）
  ukPhone: 'ˈiːvn',       // 英式音标
  usPhone: 'ˈiːvən',      // 美式音标
  translations: [         // 分组的翻译
    {
      type: 'adj.',
      meanings: ['平的', '平滑的', '相等的']
    },
    {
      type: 'adv.',
      meanings: ['甚至', '更加', '即使']
    },
    {
      type: 'v.',
      meanings: ['使平坦', '使相等']
    }
  ],
  translation: 'adj. 平的；平滑的...', // 兼容旧格式
  wordType: 'adj.'        // 第一个词性（兼容）
}
```

### 前端显示

**布局结构：**
```
┌─────────────────────────────┐
│ even                    ×   │  ← 单词标题 + 关闭按钮
├─────────────────────────────┤
│ UK [ˈiːvn]  US [ˈiːvən]    │  ← 英美音标
├─────────────────────────────┤
│ ┃ adj. 平的；平滑的；相等的 │  ← 词性 + 释义（带左边框）
│ ┃ adv. 甚至；更加；即使     │
│ ┃ v.   使平坦；使相等        │
│ ┃ n.   傍晚；平地            │
├─────────────────────────────┤
│ 上下文:                     │
│ ...sentence context...      │
├─────────────────────────────┤
│ [➕ 加入单词本]              │
└─────────────────────────────┘
```

**CSS样式特点：**
- 左边紫色竖线区分不同词性组
- 词性标签紫色加粗（n./v./adj.等）
- 释义用分号（；）分隔
- 英美音标并排显示
- 响应式布局，移动端友好

## 支持的词性

系统识别以下词性标记：

| 缩写 | 全称 | 中文 |
|------|------|------|
| n. | noun | 名词 |
| v. | verb | 动词 |
| adj. | adjective | 形容词 |
| adv. | adverb | 副词 |
| prep. | preposition | 介词 |
| conj. | conjunction | 连词 |
| pron. | pronoun | 代词 |
| int. | interjection | 感叹词 |
| num. | numeral | 数词 |
| art. | article | 冠词 |
| abbr. | abbreviation | 缩写 |

## 兼容性

### 向后兼容
如果有道词典API返回的数据格式变化，系统会：
1. 尝试解析新格式
2. 失败时回退到简单翻译格式
3. 保留 `translation` 和 `wordType` 字段用于兼容

### 备用方案
如果有道词典不可用：
1. 使用阿里云翻译API（简单翻译）
2. 显示为单一释义，无词性分组

## 用户体验改进

### 之前的问题
- 只显示第一个释义
- 用户无法了解单词的其他用法
- 特别是像 "even"、"run" 这类多义词，信息不全

### 现在的优势
✅ 显示所有词性和释义
✅ 清晰的视觉层级
✅ 英美音标对比
✅ 更专业的词典体验

## 测试用例

### 测试单词列表

1. **even** - 多词性，多释义
2. **run** - 动词/名词，多种用法
3. **book** - 名词/动词
4. **light** - 名词/动词/形容词
5. **well** - 副词/形容词/名词/感叹词
6. **set** - 英语中释义最多的单词之一

### 测试步骤

1. 打开任意阅读文章
2. 点击测试单词（如 "even"）
3. 确认显示：
   - ✅ 英式和美式音标
   - ✅ 所有词性标签
   - ✅ 每个词性的多个释义
   - ✅ 释义用分号分隔
   - ✅ 左侧有紫色边框
   - ✅ 词性标签为紫色加粗

## 性能优化

### 缓存策略
- 翻译结果缓存到 `word_translations` 表
- 包含完整的 `translations` 数组
- 减少API调用

### 数据大小
- 多词性数据略大于单一释义
- 但通过缓存减少了重复请求
- 整体性能影响可忽略

## 已知限制

1. **依赖有道词典API**
   - 如果API返回格式变化，可能需要调整解析逻辑
   - 有备用方案（阿里云翻译）

2. **词性识别**
   - 基于正则表达式匹配
   - 依赖有道词典的格式规范

3. **移动端显示**
   - 多释义可能较长
   - 已添加滚动支持（max-height: 80vh）

## 更新检查

刷新浏览器后（Ctrl+Shift+R），尝试点击 "even" 或 "run"：
- ✅ 看到多个词性标签
- ✅ 看到更完整的释义
- ✅ 看到英美音标对比

如果只显示一个释义，检查：
1. 后端是否已重启
2. 浏览器是否清除了缓存
3. 控制台是否有错误
